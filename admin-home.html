<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="styles.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>
    <!-- dit is de bootstrap link-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"  rel="stylesheet">
  <script>

    function deleteTables(){
      const tables = document.querySelectorAll('table');
      tables.forEach(table => {
      const headerRow = table.querySelector('thead tr'); 
      if (headerRow) {
        const rows = table.querySelectorAll('tbody tr'); 
        rows.forEach(row => {
          row.remove();
        });
      } else {
        table.remove();
      }
      });
    }

    function buildTables(data){
      data.forEach(reservation => {
        html = "";
        html += `
        <tr>
          <td>${reservation.id}</td>
          <td>${reservation.userFirstName} ${reservation.userLastName}</td>
          <td>${reservation.bookTitle}</td>
          <td>
            <button type="button" class="btn btn-primary">
              <i class="fas fa-check"></i> Approve
            </button>
            <button type="button" class="btn btn-danger">
              <i class="fa-solid fa-trash"></i> Verwijderen
            </button>
          </td>
        </tr>`;
        const table = document.getElementById(reservation.reservationStatus);
        table.insertAdjacentHTML('beforeend', html);
        const approveButton = table.querySelector('button.btn-primary');
        const declineButton = table.querySelector('button.btn-danger');
        approveButton.addEventListener('click', () => {
          if (reservation.reservationStatus == "unapproved"){
            newStatus = "approved";
          }
          else {
            newStatus = "borrowed";
          }
          fetch(`http://localhost:8080/reservation/${reservation.id}`, {
            method: "PUT",
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              reservationStatus: newStatus
            })
          })
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {
            console.log('Reservation status updated');
            deleteTables();
            getReservations();
          })
          .catch(error => {
            console.error('Error updating reservation status:', error);
          });
        })
        declineButton.addEventListener('click', () => {
          const confirmation = confirm("Weet je zeker dat je deze reservering wilt verwijderen?")
          if (confirmation){
            fetch(`http://localhost:8080/reservation/${reservation.id}`, {
              method: "DELETE"
            })
            .then(response => {
              deleteTables();
              getReservations();
            })
          }
        })
      })
      return;
    }

    function getReservations(){
      fetch(`http://localhost:8080/reservation/all`, {
        method: "GET",
      })
      .then(response => response.json())
      .then(data => {
        buildTables(data)
      })
    return;
    }
  </script>
  
  </head>

  <body>
    
    <script>
      getReservations()
    </script>

    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <img
          src="https://cdn.thalia.nu/public/thumbnails/partners/logos/WT-Basislogo-RGB_2_medium.png?Key-Pair-Id=K1299LB00EJZ7R"
          alt="WorkingTalent" width="150" 
          />
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="admin-home.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="admin-zoeken.html">Zoeken</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="admin-statistieken.html">Statistieken</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="admin-account.html">Account</a>
            </li> 
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" href="index.html">Log Uit</a>
              </li>
            </ul>
        </div>
      </div>
    </nav>

    <!-- zodra goedgekeurd in reserverings naar gereserveerd. 
    zodra uitgeleend in gereserveerd naar uitgeleend-->

    <div class="dashboard-container">
      <h2>Reserveringsverzoeken</h2>
      <table class="table table-striped" id = "unapproved">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Naam</th>
            <th scope="col">Boek</th>
            <th scope="col">Actie</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>

      <br>

      <h2>Reserveringen</h2>
      <table class="table table-striped" id = "approved">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Naam</th>
            <th scope="col">Boek</th>
            <th scope="col">Actie</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>

      <br>
      
      <h2>Uitleningen</h2>
      <table class="table table-striped" id = "borrowed">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Naam</th>
            <th scope="col">Boek</th>
            <th scope="col">Actie</th>
          </tr>
        </thead>
        <tbody>
      </tbody>
      </table>

      <br>

      <h2>Recente reviews</h2>
      <table class="table table-striped" id = "recent-reviews">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Naam</th>
            <th scope="col">Boek</th>
            <th scope="col">Reactie</th>
            <th scope="col">Actie</th>
          </tr>
        </thead>
        <tbody>
      </tbody>
    </div>
    
    <script src="script.js" defer></script>

    <!-- dit is de bootstrap link-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  </body>
</html>